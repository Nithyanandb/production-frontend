import{j as e,m as t,r as s,u as a,y as r,x as n,H as l,C as c,q as i,v as o}from"./index-DPGmTnef.js";import"./react-BAR5trb5.js";import"./vendor-Cqa_4s5f.js";const d=({segments:s,selectedSegment:a,onSegmentChange:r})=>e.jsx("div",{className:"flex items-center gap-2 mb-8 overflow-x-auto scrollbar-hide",children:s.map((s=>e.jsx(t.button,{onClick:()=>r(s),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-4 py-2 rounded-lg text-sm font-medium transition-all \n            "+(a===s?"bg-white text-black":"text-gray-400 hover:text-white"),children:s},s)))}),m="cu147s1r01qjiern2jmgcu147s1r01qjiern2jn0",x="https://finnhub.io/api/v1",p=18e5,g={async getQuote(e){const t=`quote_${e}`,s=localStorage.getItem(t),a=localStorage.getItem(`${t}_timestamp`),r=Date.now();if(s&&a&&r-Number(a)<p)return JSON.parse(s);const n=await fetch(`${x}/quote?symbol=${e}&token=${m}`);if(!n.ok)throw new Error("Failed to fetch quote");const l=await n.json();return localStorage.setItem(t,JSON.stringify(l)),localStorage.setItem(`${t}_timestamp`,r.toString()),l},async getRecommendationTrends(e){const t=`recommendation_${e}`,s=localStorage.getItem(t),a=localStorage.getItem(`${t}_timestamp`),r=Date.now();if(s&&a&&r-Number(a)<p)return JSON.parse(s);const n=await fetch(`${x}/stock/recommendation?symbol=${e}&token=${m}`);if(!n.ok)throw new Error("Failed to fetch recommendation trends");const l=await n.json();return localStorage.setItem(t,JSON.stringify(l)),localStorage.setItem(`${t}_timestamp`,r.toString()),l}},h=({holdings:l,onStockSelect:c})=>{const[i,o]=s.useState(l),[d,m]=s.useState(!1),[x,p]=s.useState(null),[h,u]=s.useState(""),[y,b]=s.useState(1),f=a(),j=18e5;s.useEffect((()=>{const e=async()=>{m(!0);try{const e=await Promise.all(l.map((async e=>{const t=`stockData_${e.symbol}`,s=localStorage.getItem(t),a=localStorage.getItem(`${t}_timestamp`),r=Date.now();if(s&&a&&r-Number(a)<j)return JSON.parse(s);try{const s=await g.getQuote(e.symbol),a={...e,currentPrice:s.c||0,change:s.d||0,changePercent:s.dp||0,highPrice:s.h||0,lowPrice:s.l||0,openPrice:s.o||0,previousClose:s.pc||0};return localStorage.setItem(t,JSON.stringify(a)),localStorage.setItem(`${t}_timestamp`,r.toString()),a}catch(n){return console.error(`Failed to fetch data for ${e.symbol}:`,n),{...e,currentPrice:0,change:0,changePercent:0,highPrice:0,lowPrice:0,openPrice:0,previousClose:0}}})));s.startTransition((()=>{o(e)}))}catch(e){s.startTransition((()=>{p("Failed to fetch stock data. Please try again later.")}))}finally{s.startTransition((()=>{m(!1)}))}};l.length>0&&e();const t=setInterval(e,j);return()=>clearInterval(t)}),[l]);const N=i.filter((e=>e.symbol.toLowerCase().includes(h.toLowerCase())||e.name&&e.name.toLowerCase().includes(h.toLowerCase()))),v=N.slice(10*(y-1),10*y);return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(r,{})}):x?e.jsx("div",{className:"text-center py-4 text-red-600",children:x}):i&&0!==i.length?e.jsxs("div",{className:"overflow-x-auto w-full custom-scrollbar",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(n,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search holdings...",value:h,onChange:e=>u(e.target.value),className:"w-[500px] bg-white rounded-xl pl-12 pr-4 py-3 text-black"})]}),e.jsxs("table",{className:"min-w-full bg-white text-black",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Symbol"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Current Price"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Change"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Change %"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"High Price"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Low Price"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Open Price"}),e.jsx("th",{className:"px-5 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Previous Close"})]})}),e.jsx("tbody",{children:v.map((s=>{var a,r,n,l,i,o,d;return e.jsxs(t.tr,{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>{return c(e=s),void f("/stock/buy",{state:{selectedStock:e}});var e},transition:{type:"spring",stiffness:300},children:[e.jsx("td",{className:"px-5 py-4 font-medium",children:s.symbol}),e.jsx("td",{className:"px-5 py-4 text-gray-700",children:s.name??"N/A"}),e.jsx("td",{className:"px-5 py-4",children:s.quantity}),e.jsxs("td",{className:"px-5 py-4",children:["₹",(null==(a=s.currentPrice)?void 0:a.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-5 py-4 "+((s.change??0)>=0?"text-green-600":"text-red-600"),children:["$",(null==(r=s.change)?void 0:r.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-5 py-4 "+((s.changePercent??0)>=0?"text-green-600":"text-red-600"),children:[(null==(n=s.changePercent)?void 0:n.toFixed(2))??"0.00","%"]}),e.jsxs("td",{className:"px-5 py-4",children:["₹",(null==(l=s.highPrice)?void 0:l.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-5 py-4",children:["₹",(null==(i=s.lowPrice)?void 0:i.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-5 py-4",children:["₹",(null==(o=s.openPrice)?void 0:o.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-5 py-4",children:["₹",(null==(d=s.previousClose)?void 0:d.toFixed(2))??"0.00"]})]},s.symbol)}))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx("button",{onClick:()=>{b((e=>Math.max(e-1,1)))},disabled:1===y,className:"flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-black border border-gray-300 rounded-lg hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",y]}),e.jsx("button",{onClick:()=>{b((e=>e+1))},disabled:10*y>=N.length,className:"flex items-center justify-center px-4 py-2 text-sm font-medium text-black bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200",children:"Next"})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-600",children:"No holdings available."})},u=["ALL","TECHNOLOGY","FINANCE","HEALTHCARE","ENERGY","CONSUMER"],y=()=>{const[a,r]=s.useState("ALL"),[n,m]=s.useState([]),[x,p]=s.useState(null),g=s.useRef(null),y=()=>{const e=new WebSocket("wss://ws.finnhub.io?token=ctre6q9r01qhb16mmh70ctre6q9r01qhb16mmh7g");e.addEventListener("open",(()=>{console.log("WebSocket connection opened"),p(null);["AAPL","BINANCE:BTCUSDT","IC MARKETS:1"].forEach((t=>{e.send(JSON.stringify({type:"subscribe",symbol:t}))}))})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);if("trade"===t.type){const e=t.data.map((e=>({symbol:e.s,price:e.p,timestamp:e.t,volume:e.v})));m((t=>{const s=e.filter((e=>!t.some((t=>t.symbol===e.symbol&&t.timestamp===e.timestamp))));return[...t,...s].slice(-5)}))}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e),p("WebSocket error. Please refresh the page.")})),e.addEventListener("close",(()=>{console.log("WebSocket connection closed"),p("WebSocket connection closed. Reconnecting..."),setTimeout((()=>y()),5e3)})),g.current=e};return s.useEffect((()=>(y(),()=>{g.current&&g.current.close()})),[]),e.jsxs("div",{className:"min-h-screen bg-white text-black font-sans",children:[e.jsx(l,{}),e.jsxs("div",{className:"flex h-screen pt-20",children:[e.jsx("div",{className:"p-4 ml-2 overflow-y-auto w-[400px] h-full border-r border-gray-200 bg-white",children:e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3 flex items-center gap-2",children:"Trades - Last Price Updates"}),x?e.jsx("div",{className:"flex justify-center items-center py-4",children:e.jsx("span",{className:"text-red-500",children:x})}):e.jsx("div",{className:"space-y-3 mt-8",children:n.length>0?n.map(((t,s)=>e.jsxs("div",{className:"p-4 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-900",children:t.symbol}),e.jsx("span",{className:"text-xs text-gray-500",children:t.symbol.toUpperCase()})]}),e.jsxs("span",{className:"text-sm text-gray-900",children:["$",t.price.toLocaleString()]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Volume:"}),e.jsx("span",{className:"text-gray-900",children:t.volume.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Time:"}),e.jsx("span",{className:"text-gray-900",children:new Date(t.timestamp).toLocaleTimeString()})]})]})]},s))):e.jsx("p",{className:"text-sm text-gray-600",children:"No trades available yet."})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"container mx-auto px-8 py-12",children:[e.jsx("div",{className:"flex flex-col gap-6 mb-12",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-bold text-black",children:"Market Holdings"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{size:20,className:"text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Market ",(new Date).toLocaleTimeString()]})]})]})}),e.jsx(d,{segments:u,selectedSegment:a,onSegmentChange:r}),e.jsx(i,{mode:"wait",children:e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(h,{holdings:o,onStockSelect:()=>{}})})})]})})]})]})};export{y as default};
//# sourceMappingURL=StockMarket-Co1S05z8.js.map
