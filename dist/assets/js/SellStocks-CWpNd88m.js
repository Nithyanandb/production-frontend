import{r as e,a as t,j as s,X as a,P as l,A as r,m as i,R as n,i as o,k as c,Y as d,T as x,l as m,G as h,o as u,p as f,q as b,H as p,D as g,w as y,x as j,y as v}from"./index-BbyZfmWP.js";import{M as N,A as w,e as k}from"./index-DKUGlh1D.js";import"./react-BAR5trb5.js";import"./vendor-Cqa_4s5f.js";const S=({stock:i,onClose:n,onSuccess:o})=>{var c;const[d,x]=e.useState(1),{isAuthenticated:m}=t(),[h,u]=e.useState(!1),[f,b]=e.useState(null),p=async()=>{m?d<=0?b("Quantity must be greater than 0."):!i||d>i.quantity?b("Quantity exceeds available shares."):(b(null),o(d),n()):u(!0)};return i?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-xl z-50 flex items-center justify-center",children:s.jsxs("div",{className:"bg-[#111111] backdrop-blur-xl rounded-2xl p-8 w-full max-w-md mx-4 border border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-medium text-white",children:i.name}),s.jsx("p",{className:"text-white/60 text-sm",children:i.symbol})]}),s.jsx("button",{onClick:n,className:"text-white/60 hover:text-white transition-colors p-2 rounded-full hover:bg-white/5",children:s.jsx(a,{size:24})})]}),s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[s.jsx("span",{className:"text-sm text-white/60",children:"Quantity"}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsx("button",{onClick:()=>x(Math.max(1,d-1)),className:"w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white border border-white/10 transition-all",children:s.jsx(N,{size:20})}),s.jsx("span",{className:"text-4xl font-light text-white w-16 text-center",children:d}),s.jsx("button",{onClick:()=>x(Math.min(i.quantity,d+1)),className:"w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white border border-white/10 transition-all",children:s.jsx(l,{size:20})})]}),s.jsxs("p",{className:"text-white/40 text-sm",children:["Available: ",i.quantity," shares"]})]}),s.jsxs("div",{className:"space-y-4 border-t border-white/10 pt-6",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-white/60",children:"Price per share"}),s.jsxs("span",{className:"text-white font-medium",children:["₹",null==(c=i.price)?void 0:c.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-xl",children:[s.jsx("span",{className:"text-white/80",children:"Total Amount"}),s.jsxs("span",{className:"text-white font-medium",children:["₹",(i.price*d).toFixed(2)]})]})]}),f&&s.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 text-red-400 text-sm",children:f}),s.jsxs("div",{className:"space-y-3 pt-4",children:[s.jsx("button",{onClick:p,className:"w-full py-4 bg-red-500 text-white rounded-full font-medium hover:bg-red-600 transition-all text-sm uppercase tracking-wide",children:"Sell Now"}),s.jsx("button",{onClick:n,className:"w-full py-4 text-white/60 font-medium hover:text-white transition-colors text-sm uppercase tracking-wide",children:"Cancel"})]})]})]})}),s.jsx(r,{isOpen:h,onClose:()=>u(!1),onSuccess:()=>{u(!1),i&&p()}})]}):null},D=(e,t=.005)=>e+e*t*(Math.random()-.5),F=({symbol:t,onTimeframeChange:a,basePrice:l=100})=>{const[r,h]=e.useState("1D"),[u,f]=e.useState([]),[b,p]=e.useState(null),g={AAPL:150,MSFT:380,GOOGL:140,TSLA:250,NVDA:800}[t]||l;e.useEffect((()=>{const e=((e,t=100)=>{const s=[],a={"1D":78,"1W":168,"1M":30,"3M":90,"1Y":252,ALL:1260}[e]||78;let l=t;const r=new Date;for(let i=0;i<a;i++){const t=new Date(r);"1D"===e?t.setMinutes(t.getMinutes()-5*i):"1W"===e?t.setHours(t.getHours()-i):t.setDate(t.getDate()-i),l=D(l),s.unshift({date:t.toISOString(),price:Number(l.toFixed(2))})}return s})(r,g);if(f(e),"1D"===r){const t=setInterval((()=>{const t=e[e.length-1].price,s=D(t,.001),a=[...e.slice(1),{date:(new Date).toISOString(),price:s}];f(a)}),5e3);return()=>clearInterval(t)}}),[r,g]);const y=u.length>0?u[u.length-1].price-u[0].price:0,j=u.length>0?(y/u[0].price*100).toFixed(2):"0.00",v=({active:e,payload:t,label:a})=>{if(e&&t&&t.length){const e=new Date(a),l=t[0].value;return s.jsxs("div",{className:"bg-white/90 backdrop-blur-xl border border-gray-200 rounded-lg p-4 shadow-xl",children:[s.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"1D"===r?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString([],{month:"short",day:"numeric"})}),s.jsxs("p",{className:"text-black text-lg font-medium",children:["$",l.toFixed(2)]})]})}return null};return s.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"relative h-full bg-white rounded-2xl p-6 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-2xl font-light text-black",children:t}),s.jsxs("div",{className:`text-sm ${y>=0?"text-green-600":"text-red-600"} font-light`,children:[y>=0?"+":"",j,"%"]})]}),s.jsx("div",{className:"flex gap-2",children:["1D","1W","1M","3M","1Y","ALL"].map((e=>s.jsx("button",{onClick:()=>(e=>{h(e),null==a||a(e)})(e),className:"px-4 py-2 rounded-full text-sm transition-all "+(r===e?"bg-black text-white font-medium":"bg-gray-100 text-gray-600 hover:bg-gray-200 hover:text-black"),children:e},e)))})]}),s.jsx(n,{width:"100%",height:"85%",children:s.jsxs(w,{data:u,onMouseMove:e=>{e.activePayload&&p(e.activePayload[0].payload)},onMouseLeave:()=>p(null),children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"colorPrice",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:y>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",stopOpacity:.2}),s.jsx("stop",{offset:"95%",stopColor:y>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",stopOpacity:0})]})}),s.jsx(o,{strokeDasharray:"3 3",stroke:"rgba(0,0,0,0.05)",vertical:!1}),s.jsx(c,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return"1D"===r?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{day:"numeric",month:"short"})},stroke:"rgba(0,0,0,0.1)",tick:{fill:"rgba(0,0,0,0.4)",fontSize:11},axisLine:{stroke:"rgba(0,0,0,0.1)"},tickLine:{stroke:"rgba(0,0,0,0.1)"}}),s.jsx(d,{domain:["auto","auto"],stroke:"rgba(0,0,0,0.1)",tick:{fill:"rgba(0,0,0,0.4)",fontSize:11},tickFormatter:e=>`$${e.toFixed(2)}`,axisLine:{stroke:"rgba(0,0,0,0.1)"},tickLine:{stroke:"rgba(0,0,0,0.1)"},width:65}),s.jsx(x,{content:s.jsx(v,{})}),s.jsx(m,{type:"monotone",dataKey:"price",stroke:y>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",strokeWidth:1.5,fill:"url(#colorPrice)",animationDuration:750,dot:!1,activeDot:{r:4,fill:y>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",stroke:"#fff",strokeWidth:1}})]})}),b&&s.jsxs(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute top-4 right-4 bg-white/90 backdrop-blur-xl border border-gray-200 rounded-lg p-4 shadow-sm",children:[s.jsx("p",{className:"text-gray-600 text-sm",children:"Current Price"}),s.jsxs("p",{className:"text-black text-2xl font-medium",children:["$",b.price.toFixed(2)]})]})]},t)},C=({stock:t,onSellClick:a,loading:l})=>{var r;const[n,o]=e.useState("1D"),[c,d]=e.useState(new Date),[x,m]=e.useState([]),[p,g]=e.useState(!1);if(e.useEffect((()=>{const e=setInterval((()=>{d(new Date)}),1e3);return()=>clearInterval(e)}),[]),l||!t)return s.jsx("div",{className:"h-full flex items-center justify-center text-gray-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx(h,{size:48,className:"mx-auto mb-4 opacity-60"}),s.jsx("p",{className:"text-xl font-light",children:"Select a stock to view details"})]})});const y={strongBuy:"#22c55e",buy:"#4ade80",hold:"#facc15",sell:"#f87171",strongSell:"#ef4444"};return s.jsx(u,{mode:"wait",children:s.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col h-full bg-white rounded-2xl p-6 lg:p-8 shadow-sm",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-light text-black mb-1",children:t.name}),s.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[s.jsx("span",{className:"text-gray-600",children:t.symbol}),s.jsx("span",{className:"text-gray-300",children:"•"}),s.jsx("span",{className:"text-gray-600 font-light",children:c.toLocaleTimeString()})]})]})}),s.jsxs("div",{className:"flex items-baseline gap-4 mb-8",children:[s.jsxs("span",{className:"text-5xl font-light text-black",children:["$",(null==(r=t.currentPrice)?void 0:r.toFixed(2))||"N/A"]}),s.jsxs(i.span,{animate:{color:(t.totalReturn||0)>=0?"#22c55e":"#ef4444"},className:"flex items-center text-lg font-light",children:[(t.totalReturn||0)>=0?s.jsx(f,{size:20}):s.jsx(b,{size:20}),Math.abs(t.totalReturn||0).toFixed(2),"%"]})]}),s.jsx("div",{className:"flex gap-2 mb-8 overflow-x-auto scrollbar-hide",children:["1D","1W","1M","3M","1Y","ALL"].map((e=>s.jsx("button",{onClick:()=>o(e),className:"px-6 py-2 rounded-full text-sm font-medium transition-all "+(n===e?"bg-black text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200 hover:text-black"),children:e},e)))}),s.jsx("div",{className:"flex-1 bg-gray-100 rounded-2xl mb-8 overflow-hidden",children:s.jsx("div",{className:"h-full p-4",children:s.jsx(F,{stock:t,timeFrame:n})})}),s.jsxs("div",{className:"bg-gray-100 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xl font-light text-black mb-6",children:"Market Analysis"}),p?s.jsx("div",{className:"flex justify-center items-center py-8",children:s.jsx(i.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-2 border-gray-300 border-t-black rounded-full"})}):x.length>0?s.jsx("div",{className:"space-y-6",children:x.map(((e,t)=>s.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-4 font-light",children:e.period}),s.jsx("div",{className:"grid grid-cols-5 gap-4",children:[{label:"Strong Buy",value:e.strongBuy,color:y.strongBuy},{label:"Buy",value:e.buy,color:y.buy},{label:"Hold",value:e.hold,color:y.hold},{label:"Sell",value:e.sell,color:y.sell},{label:"Strong Sell",value:e.strongSell,color:y.strongSell}].map(((e,t)=>s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-2 font-light",children:e.label}),s.jsx("p",{className:"text-lg font-light",style:{color:e.color},children:e.value})]},t)))})]},t)))}):s.jsx("div",{className:"flex justify-center items-center py-8",children:s.jsx("span",{className:"text-gray-500 font-light",children:"No market analysis available"})})]})]})})},A=e=>new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),L=()=>{const{user:a,token:l}=t(),[r,n]=e.useState(!0),[o,c]=e.useState(null),[d,x]=e.useState(""),[m,N]=e.useState(null),[w,D]=e.useState(null),[F,L]=e.useState(!1),[z,M]=e.useState([]),[E,P]=e.useTransition();e.useEffect((()=>{try{k.init("eyK87ZsxW822cQvyN")}catch(e){console.error("Failed to initialize EmailJS:",e)}}),[]),e.useEffect((()=>{(async()=>{try{const e=await fetch("https://production-backend-final.onrender.com/portfolio",{method:"GET",headers:{Authorization:`Bearer ${l}`}});if(!e.ok)throw new Error("Failed to fetch portfolio");const{data:t}=await e.json();if(console.log("Backend Response:",t),!Array.isArray(t))throw new Error("Invalid portfolio data format");{const e=t.filter((e=>(null==e?void 0:e.symbol)&&(null==e?void 0:e.name)));M(e)}}catch(e){console.error("Error fetching portfolio:",e),c("Failed to load portfolio"),M([])}finally{n(!1)}})()}),[l]);const T=async(e,t)=>{try{const s=await fetch("https://production-backend-final.onrender.com/transaction/sell",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({stockSymbol:e,quantity:t,price:(null==w?void 0:w.currentPrice)||0})});if(!s.ok){const e=await s.json();throw new Error(e.message||"Failed to process transaction")}M((s=>s.map((s=>{if(s.symbol===e){const e=s.quantity-t;return{...s,quantity:e}}return s})).filter((e=>e.quantity>0)))),(async(e,t,s)=>{if("number"!=typeof s||isNaN(s))console.error("Invalid totalPrice:",s);else{P((()=>{L(!0)})),setTimeout((()=>{P((()=>{L(!1)}))}),3e3);try{const e=await fetch("https://production-backend-final.onrender.com/portfolio",{method:"GET",headers:{Authorization:`Bearer ${l}`}});if(!e.ok)throw new Error("Failed to fetch portfolio");const{data:t}=await e.json();if(console.log("Backend Response:",t),!Array.isArray(t))throw new Error("Invalid portfolio data format");{const e=t.filter((e=>(null==e?void 0:e.symbol)&&(null==e?void 0:e.name)));M(e)}}catch(r){console.error("Error fetching portfolio:",r),c("Failed to load portfolio"),M([])}if(null==a?void 0:a.email)try{const l={to_email:a.email,stock_symbol:e.symbol,stock_name:e.name,quantity:t,total_price:s.toFixed(2)};await k.send("service_box535f","template_l4fugpk",l),console.log("Email notification sent successfully!")}catch(r){console.error("Failed to send email notification:",r)}else console.error("User email not found."),alert("User email not found. Please update your email in settings.")}})(w,t,w.currentPrice*t)}catch(s){console.error("Sell transaction failed:",s),c("Failed to sell stock")}},I=(Array.isArray(z)?z:[]).filter((e=>{var t,s;return(null==(t=null==e?void 0:e.symbol)?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null==(s=null==e?void 0:e.name)?void 0:s.toLowerCase().includes(d.toLowerCase()))}));return s.jsxs("div",{className:"min-h-screen bg-white text-black",children:[s.jsx(p,{}),s.jsx("div",{children:s.jsx("div",{className:"mt-32 absolute flex z-20 px-8 justify-end w-full",children:w&&s.jsxs("button",{onClick:()=>N(w),className:"px-8 py-3 bg-black text-white font-medium rounded-full hover:bg-black/90 transition-all flex items-center gap-2",children:[s.jsx(g,{size:20}),"Sell ",w.symbol]})})}),s.jsxs("div",{className:"flex h-screen pt-20",children:[s.jsx("div",{className:"w-98 border-r border-gray-200 overflow-hidden",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"relative mb-6",children:[s.jsx(y,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),s.jsx("input",{type:"text",placeholder:"Search stocks...",value:d,onChange:e=>x(e.target.value),className:"w-full bg-white border border-gray-300 rounded-2xl pl-12 pr-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-black/20"})]}),s.jsx("div",{className:"space-y-4 overflow-y-auto w-[400px] h-[calc(100vh-200px)]",children:r?s.jsx(j,{}):I.map((e=>{return s.jsx(i.div,{layout:!0,className:"p-4 rounded-xl cursor-pointer transition-all "+((null==w?void 0:w.symbol)===e.symbol?"bg-gray-200":"bg-white hover:bg-gray-100"),onClick:()=>{D(e)},children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:e.symbol}),s.jsx("p",{className:"text-sm text-gray-600",children:e.name})]}),s.jsxs(i.div,{animate:{color:(e.totalReturn||0)>=0?"#34D399":"#EF4444"},className:"text-right",children:[s.jsx("p",{className:"font-medium",children:(t=e.currentPrice,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t))}),s.jsx("p",{className:"text-sm flex items-center gap-1",children:void 0!==e.totalReturn&&s.jsxs(s.Fragment,{children:[e.totalReturn>=0?s.jsx(f,{size:12}):s.jsx(b,{size:12}),A(Math.abs(e.totalReturn))]})})]})]})},e.symbol);var t}))})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:w?s.jsx(C,{stock:w,onSellClick:N,loading:r}):s.jsx("div",{className:"h-full flex items-center justify-center text-gray-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx(h,{size:48,className:"mx-auto mb-4 opacity-60"}),s.jsx("p",{className:"text-xl",children:"Select a stock to view details"})]})})})]}),s.jsx(u,{children:F&&s.jsxs(i.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"fixed inset-0 flex items-center justify-center z-50",children:[s.jsx("div",{className:"bg-black/50 backdrop-blur-sm fixed inset-0"})," ",s.jsx(i.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"bg-white backdrop-blur-lg rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 border border-gray-200",children:s.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[s.jsx("div",{className:"bg-green-500/10 rounded-full p-3",children:s.jsx(v,{className:"w-8 h-8 text-green-500"})}),s.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Success!"}),s.jsx("p",{className:"text-gray-600",children:"Transaction completed successfully! A notification has been sent to your email."}),s.jsx("button",{onClick:()=>L(!1),className:"mt-4 px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Close"})]})})]})}),m&&s.jsx(S,{stock:m,onClose:()=>N(null),onSuccess:e=>T(m.symbol,e)})]})};export{L as SellStocks,L as default};
//# sourceMappingURL=SellStocks-CWpNd88m.js.map
