import{j as e,m as t,r as s,u as a,x as r,w as c,H as l,C as n,o as i,t as o}from"./index-BbyZfmWP.js";import"./react-BAR5trb5.js";import"./vendor-Cqa_4s5f.js";const d=({segments:s,selectedSegment:a,onSegmentChange:r})=>e.jsx("div",{className:"flex items-center gap-2 mb-8 overflow-x-auto scrollbar-hide",children:s.map((s=>e.jsx(t.button,{onClick:()=>r(s),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-4 py-2 rounded-lg text-sm font-medium transition-all \n            "+(a===s?"bg-white text-black":"text-gray-400 hover:text-white"),children:s},s)))}),x=({holdings:l,onStockSelect:n})=>{const[i,o]=s.useState(l),[d,x]=s.useState(!1),[m,h]=s.useState(null),[p,u]=s.useState(""),g=a();s.useEffect((()=>{l.length>0&&(async()=>{x(!0);try{const e=l.slice(0,15),t=await Promise.all(e.map((async e=>{try{const t=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e.symbol}&token=ctre6q9r01qhb16mmh70ctre6q9r01qhb16mmh7g`),s=await t.json();return s&&s.c?{...e,currentPrice:s.c,change:s.d,changePercent:s.dp,highPrice:s.h,lowPrice:s.l,openPrice:s.o,previousClose:s.pc}:{...e,currentPrice:0,change:0,changePercent:0,highPrice:0,lowPrice:0,openPrice:0,previousClose:0}}catch(t){return console.error(`Failed to fetch data for ${e.symbol}:`,t),{...e,currentPrice:0,change:0,changePercent:0,highPrice:0,lowPrice:0,openPrice:0,previousClose:0}}}))),s=l.slice(15).map((e=>({...e,currentPrice:0,change:0,changePercent:0,highPrice:0,lowPrice:0,openPrice:0,previousClose:0})));o([...t,...s])}catch(e){h("Failed to fetch stock data. Please try again later.")}finally{x(!1)}})()}),[l]);const y=i.filter((e=>e.symbol.toLowerCase().includes(p.toLowerCase())||e.name&&e.name.toLowerCase().includes(p.toLowerCase())));return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(r,{})}):m?e.jsx("div",{className:"text-center py-4 text-red-600",children:m}):i&&0!==i.length?e.jsxs("div",{className:"overflow-x-auto custom-scrollbar",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(c,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search holdings...",value:p,onChange:e=>u(e.target.value),className:"w-full bg-gray-100 border border-gray-300 rounded-2xl pl-12 pr-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"})]}),e.jsxs("table",{className:"min-w-full bg-white text-black",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Symbol"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Current Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Change"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Change %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"High Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Low Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Open Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Previous Close"})]})}),e.jsx("tbody",{children:y.map((s=>{var a,r,c,l,i,o,d;return e.jsxs(t.tr,{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>{return n(e=s),void g("/stock/buy",{state:{selectedStock:e}});var e},transition:{type:"spring",stiffness:300},children:[e.jsx("td",{className:"px-6 py-4 font-medium",children:s.symbol}),e.jsx("td",{className:"px-6 py-4 text-gray-700",children:s.name??"N/A"}),e.jsx("td",{className:"px-6 py-4",children:s.quantity}),e.jsxs("td",{className:"px-6 py-4",children:["₹",(null==(a=s.currentPrice)?void 0:a.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-6 py-4 "+((s.change??0)>=0?"text-green-600":"text-red-600"),children:["$",(null==(r=s.change)?void 0:r.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-6 py-4 "+((s.changePercent??0)>=0?"text-green-600":"text-red-600"),children:[(null==(c=s.changePercent)?void 0:c.toFixed(2))??"0.00","%"]}),e.jsxs("td",{className:"px-6 py-4",children:["₹",(null==(l=s.highPrice)?void 0:l.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-6 py-4",children:["₹",(null==(i=s.lowPrice)?void 0:i.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-6 py-4",children:["₹",(null==(o=s.openPrice)?void 0:o.toFixed(2))??"0.00"]}),e.jsxs("td",{className:"px-6 py-4",children:["₹",(null==(d=s.previousClose)?void 0:d.toFixed(2))??"0.00"]})]},s.symbol)}))})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-600",children:"No holdings available."})},m=["ALL","TECHNOLOGY","FINANCE","HEALTHCARE","ENERGY","CONSUMER"],h=()=>{const[a,r]=s.useState("ALL"),[c,h]=s.useState([]),[p,u]=s.useState(null),g=s.useRef(null);return s.useEffect((()=>((()=>{const e=new WebSocket("wss://ws.finnhub.io?token=ctre6q9r01qhb16mmh70ctre6q9r01qhb16mmh7g");e.addEventListener("open",(()=>{console.log("WebSocket connection opened"),u(null),["AAPL","BINANCE:BTCUSDT","IC MARKETS:1"].forEach((t=>{e.send(JSON.stringify({type:"subscribe",symbol:t}))}))})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);if("trade"===t.type){const e=t.data.map((e=>({symbol:e.s,price:e.p,timestamp:e.t,volume:e.v})));h((t=>{const s=e.filter((e=>!t.some((t=>t.symbol===e.symbol&&t.timestamp===e.timestamp))));return[...t,...s].slice(-4)}))}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e),u("WebSocket error. Please refresh the page.")})),e.addEventListener("close",(()=>{console.log("WebSocket connection closed"),u("WebSocket connection closed. Please refresh the page.")})),g.current=e})(),()=>{g.current&&g.current.close()})),[]),e.jsxs("div",{className:"min-h-screen bg-white text-black font-sans",children:[e.jsx(l,{}),e.jsxs("div",{className:"flex h-screen pt-20",children:[e.jsxs("div",{className:"p-8 space-y-4 overflow-y-auto w-[400px] h-full border-r border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black mb-6",children:"Trades - Last Price Updates"}),p?e.jsx("div",{className:"flex justify-center items-center py-4",children:e.jsx("span",{className:"text-red-500",children:p})}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-xl p-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Recent Trades"}),e.jsx("div",{className:"space-y-4",children:c.length>0?c.map(((t,s)=>e.jsxs("div",{className:"text-sm text-gray-600 bg-white p-2 rounded-lg",children:[e.jsxs("p",{children:["Symbol: ",e.jsx("span",{className:"p-2 text-black font-medium",children:t.symbol})]}),e.jsxs("p",{children:["Price: ",e.jsx("span",{className:"p-2 text-black font-medium",children:t.price})]}),e.jsxs("p",{children:["Volume: ",e.jsx("span",{className:"p-2 text-black font-medium",children:t.volume})]}),e.jsxs("p",{children:["Time: ",e.jsx("span",{className:"p-2 text-black font-medium",children:new Date(t.timestamp).toLocaleTimeString()})]})]},s))):e.jsx("p",{className:"text-sm text-gray-600",children:"No trades available yet."})})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"container mx-auto px-8 py-12",children:[e.jsx("div",{className:"flex flex-col gap-6 mb-12",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-bold text-black",children:"Market Holdings"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{size:20,className:"text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Market ",(new Date).toLocaleTimeString()]})]})]})}),e.jsx(d,{segments:m,selectedSegment:a,onSegmentChange:r}),e.jsx(i,{mode:"wait",children:e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(x,{holdings:o,onStockSelect:()=>{}})})})]})})]})]})};export{h as default};
//# sourceMappingURL=StockMarket-IGayt0ZC.js.map
