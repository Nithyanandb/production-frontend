import{r as e,a as t,j as s,X as r,P as i,A as l,m as n,R as a,i as o,k as c,Y as d,T as h,l as x,G as m,o as u,p as f,q as p,t as g,v as y,H as b,D as v,w as j,x as w,y as N}from"./index-BbyZfmWP.js";import{M as S,A as k,e as I}from"./index-DKUGlh1D.js";import"./react-BAR5trb5.js";import"./vendor-Cqa_4s5f.js";function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)({}).hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},C.apply(null,arguments)}function _(e,t){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}const O=({stock:n,onClose:a,onSuccess:o})=>{var c;const[d,h]=e.useState(1),{isAuthenticated:x}=t(),[m,u]=e.useState(!1),{isProcessing:f,error:p,handlePurchase:g}=function({onSuccess:s}){const[r,i]=e.useState(!1),[l,n]=e.useState(null),{token:a,user:o,isAuthenticated:c}=t();return{isProcessing:r,error:l,handlePurchase:async(e,t)=>{if(c&&a){i(!0),n(null);try{const r=await fetch("https://production-backend-final.onrender.com/transaction/buy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({stockSymbol:e.symbol,stockName:e.name,quantity:t,price:e.price,userId:null==o?void 0:o.email})});if(!r.ok){const e=await r.json();throw new Error(e.message||"Transaction failed")}s()}catch(r){n(r instanceof Error?r.message:"Transaction failed")}finally{i(!1)}}else n("Please login to continue")}}}({onSuccess:()=>{if(!n)return;const e=n.price*d;o(d,e),a()}});return n?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-xl z-50 flex items-center justify-center",children:s.jsxs("div",{className:"bg-[#111111] backdrop-blur-xl rounded-2xl p-8 w-full max-w-md mx-4 border border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-medium text-white",children:n.name}),s.jsx("p",{className:"text-white/60 text-sm",children:n.symbol})]}),s.jsx("button",{onClick:a,className:"text-white/60 hover:text-white transition-colors p-2 rounded-full hover:bg-white/5",children:s.jsx(r,{size:24})})]}),s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[s.jsx("span",{className:"text-sm text-white/60",children:"Quantity"}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsx("button",{onClick:()=>h(Math.max(1,d-1)),className:"w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white border border-white/10 transition-all",children:s.jsx(S,{size:20})}),s.jsx("span",{className:"text-4xl font-light text-white w-16 text-center",children:d}),s.jsx("button",{onClick:()=>h(d+1),className:"w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white border border-white/10 transition-all",children:s.jsx(i,{size:20})})]})]}),s.jsxs("div",{className:"space-y-4 border-t border-white/10 pt-6",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-white/60",children:"Price per share"}),s.jsxs("span",{className:"text-white font-medium",children:["₹",null==(c=n.price)?void 0:c.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-xl",children:[s.jsx("span",{className:"text-white/80",children:"Total Amount"}),s.jsxs("span",{className:"text-white font-medium",children:["₹",(n.price*d).toFixed(2)]})]})]}),p&&s.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 text-red-400 text-sm",children:p}),s.jsxs("div",{className:"space-y-3 pt-4",children:[s.jsx("button",{onClick:async()=>{x?n&&await g(n,d):u(!0)},disabled:f,className:"w-full py-4 bg-white text-black rounded-full font-medium hover:bg-white/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm uppercase tracking-wide",children:f?"Processing...":"Buy Now"}),s.jsx("button",{onClick:a,className:"w-full py-4 text-white/60 font-medium hover:text-white transition-colors text-sm uppercase tracking-wide",children:"Cancel"})]})]})]})}),s.jsx(l,{isOpen:m,onClose:()=>u(!1),onSuccess:()=>{u(!1),n&&g(n,d)}})]}):null},z=(e,t=100)=>{const s=[],r={"1D":78,"1W":168,"1M":30,"3M":90,"1Y":252,ALL:1260}[e]||78,i=((e,t,s=.002)=>{let r=[e];for(let i=1;i<t;i++){const t=r[i-1]*s*(Math.random()-.5)*.5+.3*(r[i-1]-(i>1?r[i-2]:e));r.push(r[i-1]+t)}return r})(t,r),l=new Date;for(let n=0;n<r;n++){const t=new Date(l);"1D"===e?t.setMinutes(t.getMinutes()-5*n):"1W"===e?t.setHours(t.getHours()-n):t.setDate(t.getDate()-n),s.unshift({date:t.toISOString(),price:Number(i[n].toFixed(2))})}return s},T=({stock:t,timeFrame:r,onTimeframeChange:i})=>{const[l,m]=e.useState([]),[u,f]=e.useState(!0),[p,g]=e.useState(null),y=e.useCallback((()=>{if(0===l.length)return;const e=l[l.length-1].price,s=t.changePercent/100,r=1e-4*e*(Math.random()-.5+.3*s),i=Number((e+r).toFixed(2)),n={date:(new Date).toISOString(),price:i};m((e=>[...e.slice(1),n]))}),[l,t.changePercent]);e.useEffect((()=>{f(!0);const e=setTimeout((()=>{const e=z(r,t.price);m(e),f(!1)}),100);return()=>clearTimeout(e)}),[r,t.price]),e.useEffect((()=>{if(u||"1D"!==r)return;const e=setInterval((()=>{y()}),5e3+2e3*Math.random());return()=>clearInterval(e)}),[u,y,r]);const b=l.length>0?l[l.length-1].price-l[0].price:0,v=({active:e,payload:t,label:i})=>{if(e&&t&&t.length){const e=new Date(i),l=t[0].value;return s.jsxs("div",{className:"bg-white/90 backdrop-blur-xl border border-gray-200 rounded-lg p-4 shadow-xl",children:[s.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"1D"===r?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString([],{month:"short",day:"numeric"})}),s.jsxs("p",{className:"text-black text-lg font-medium",children:["$",l.toFixed(2)]})]})}return null};return s.jsxs("div",{className:"h-full relative bg-white",children:[u?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx(n.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-2 border-gray-200 border-t-gray-400 rounded-full"}),s.jsx("span",{className:"text-gray-400 text-sm font-medium",children:"Loading chart..."})]})}):s.jsx(a,{width:"95%",height:"100%",children:s.jsxs(k,{data:l,onMouseMove:e=>{e.activePayload&&g(e.activePayload[0].payload)},onMouseLeave:()=>g(null),children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"colorPrice",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"0%",stopColor:b>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",stopOpacity:.2}),s.jsx("stop",{offset:"99%",stopColor:b>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",stopOpacity:0})]})}),s.jsx(o,{strokeDasharray:"3 3",stroke:"rgba(0,0,0,0.05)",vertical:!1}),s.jsx(c,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return"1D"===r?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{day:"numeric",month:"short"})},stroke:"rgba(0,0,0,0.1)",tick:{fill:"rgba(0,0,0,0.6)",fontSize:11},axisLine:{stroke:"rgba(0,0,0,0.1)"},tickLine:{stroke:"rgba(0,0,0,0.1)"}}),s.jsx(d,{domain:["auto","auto"],stroke:"rgba(0,0,0,0.1)",tick:{fill:"rgba(0,0,0,0.6)",fontSize:11},tickFormatter:e=>`$${e.toFixed(2)}`,axisLine:{stroke:"rgba(0,0,0,0.1)"},tickLine:{stroke:"rgba(0,0,0,0.1)"},tickCount:6,width:65}),s.jsx(h,{content:s.jsx(v,{}),cursor:{stroke:"rgba(0,0,0,0.1)",strokeWidth:1,strokeDasharray:"4 4"}}),s.jsx(x,{type:"monotone",dataKey:"price",stroke:b>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",strokeWidth:1.5,fill:"url(#colorPrice)",animationDuration:750,dot:!1,activeDot:{r:4,fill:b>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)",stroke:"#fff",strokeWidth:1}})]})}),p&&s.jsxs(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute top-4 right-4 bg-white/90 backdrop-blur-xl border border-gray-200 rounded-lg p-4",children:[s.jsx("p",{className:"text-gray-600 text-sm",children:"Current Price"}),s.jsxs("p",{className:"text-black text-2xl font-medium",children:["$",p.price.toFixed(2)]})]})]})},M=({stock:t,onBuyClick:i,loading:l})=>{var a;const[o,c]=e.useState("1D"),[d,h]=e.useState(new Date),[x,g]=e.useState([]),[y,b]=e.useState(!1),[v,j]=e.useState(!1);if(e.useEffect((()=>{(async()=>{if(null==t?void 0:t.symbol){b(!0);try{const e=await fetch(`https://finnhub.io/api/v1/stock/recommendation?symbol=${t.symbol}&token=ctre6q9r01qhb16mmh70ctre6q9r01qhb16mmh7g`),s=await e.json();g(s)}catch(e){console.error("Failed to fetch recommendation trends:",e)}finally{b(!1)}}})()}),[null==t?void 0:t.symbol]),e.useEffect((()=>{const e=setInterval((()=>{h(new Date)}),1e3);return()=>clearInterval(e)}),[]),l||!t)return s.jsx("div",{className:"flex items-center justify-center h-full text-gray-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx(m,{size:48,className:"mx-auto mb-4 opacity-60"}),s.jsx("p",{className:"text-xl",children:"Select a stock to view details"})]})});const w="#16a34a",N="#4ade80",S="#facc15",k="#f87171",I="#dc2626",C=()=>{j(!1)};return s.jsx(u,{mode:"wait",children:s.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex -mt-6 flex-col h-full bg-white backdrop-blur-xl p-4 lg:p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-black",children:t.name}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx("span",{className:"text-gray-600",children:t.symbol}),s.jsx("span",{className:"text-gray-600",children:"•"}),s.jsx("span",{className:"text-gray-600",children:d.toLocaleTimeString()})]})]})}),s.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s.jsxs("span",{className:"text-4xl font-medium text-black",children:["₹",(null==(a=t.currentPrice)?void 0:a.toFixed(2))??"N/A"," "]}),s.jsxs(n.span,{animate:{color:(t.change||0)>=0?"rgb(34, 197, 94)":"rgb(239, 68, 68)"},className:"flex items-center text-lg",children:[(t.change||0)>=0?s.jsx(f,{size:20}):s.jsx(p,{size:20}),Math.abs(t.change||0).toFixed(2),"%"]})]}),s.jsx("div",{className:"flex gap-1 mb-4 overflow-x-auto scrollbar-hide",children:["1D","1W","1M","3M","1Y","ALL"].map((e=>s.jsx("button",{onClick:()=>c(e),className:"px-3 py-1 rounded-full text-xs font-medium transition-all whitespace-nowrap "+(o===e?"bg-black text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e},e)))}),s.jsx("div",{className:"flex-1 bg-gray-100 rounded-xl mt-12 backdrop-blur-sm",children:s.jsx("div",{className:"h-full",children:s.jsx(T,{stock:t,timeFrame:o})})}),s.jsxs("div",{className:"rounded-xl p-4 backdrop-blur-sm cursor-pointer",onClick:()=>{j(!0)},children:[s.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Recommendation Trends"}),y?s.jsx("div",{className:"flex justify-center items-center py-4",children:s.jsx("span",{className:"text-gray-600",children:"Loading trends..."})}):x.length>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full bg-white rounded-xl shadow-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-left",children:"Period"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Strong Buy"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Buy"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Hold"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Sell"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Strong Sell"})]})}),s.jsx("tbody",{children:x.slice(0,1).map(((e,t)=>s.jsxs("tr",{className:"border-t border-gray-200",children:[s.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.period}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:w},children:e.strongBuy}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:N},children:e.buy}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:S},children:e.hold}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:k},children:e.sell}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:I},children:e.strongSell})]},t)))})]})}):s.jsx("div",{className:"flex justify-center items-center py-4",children:s.jsx("span",{className:"text-gray-600",children:"No recommendation trends available."})})]}),s.jsx(u,{children:v&&s.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:C,children:s.jsxs(n.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:-20},className:"bg-white rounded-xl w-full max-w-2xl p-6 relative",onClick:e=>e.stopPropagation(),children:[s.jsx("button",{onClick:C,className:"absolute top-4 right-4 p-2 text-gray-600 hover:text-black",children:s.jsx(r,{size:20})}),s.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Recommendation Trends"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full bg-white rounded-xl shadow-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-left",children:"Period"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Strong Buy"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Buy"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Hold"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Sell"}),s.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 text-center",children:"Strong Sell"})]})}),s.jsx("tbody",{children:x.map(((e,t)=>s.jsxs("tr",{className:"border-t border-gray-200",children:[s.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.period}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:w},children:e.strongBuy}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:N},children:e.buy}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:S},children:e.hold}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:k},children:e.sell}),s.jsx("td",{className:"px-4 py-3 text-lg font-medium text-center",style:{color:I},children:e.strongSell})]},t)))})]})})]})})})]})})};var D=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function R(e,t){if(e.length!==t.length)return!1;for(var s=0;s<e.length;s++)if(r=e[s],i=t[s],!(r===i||D(r)&&D(i)))return!1;var r,i;return!0}function F(e,t){var s;void 0===t&&(t=R);var r,i=[],l=!1;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return l&&s===this&&t(n,i)||(r=e.apply(this,n),l=!0,s=this,i=n),r}}var L="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function E(e){cancelAnimationFrame(e.id)}var W=-1;function q(e){if(void 0===e&&(e=!1),-1===W||e){var t=document.createElement("div"),s=t.style;s.width="50px",s.height="50px",s.overflow="scroll",document.body.appendChild(t),W=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return W}var A=null;function B(e){if(void 0===e&&(e=!1),null===A||e){var t=document.createElement("div"),s=t.style;s.width="50px",s.height="50px",s.overflow="scroll",s.direction="rtl";var r=document.createElement("div"),i=r.style;return i.width="100px",i.height="100px",t.appendChild(r),document.body.appendChild(t),t.scrollLeft>0?A="positive-descending":(t.scrollLeft=1,A=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),A}return A}var H=function(e,t){return e};function U(t){var s,r=t.getItemOffset,i=t.getEstimatedTotalSize,l=t.getItemSize,n=t.getOffsetForIndexAndAlignment,a=t.getStartIndexForOffset,o=t.getStopIndexForStartIndex,c=t.initInstanceProps,d=t.shouldResetStyleCacheOnItemSizeChange,h=t.validateProps;return(s=function(t){var s,x;function m(e){var s;return(s=t.call(this,e)||this)._instanceProps=c(s.props,P(s)),s._outerRef=void 0,s._resetIsScrollingTimeoutId=null,s.state={instance:P(s),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof s.props.initialScrollOffset?s.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},s._callOnItemsRendered=void 0,s._callOnItemsRendered=F((function(e,t,r,i){return s.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:r,visibleStopIndex:i})})),s._callOnScroll=void 0,s._callOnScroll=F((function(e,t,r){return s.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:r})})),s._getItemStyle=void 0,s._getItemStyle=function(e){var t,i=s.props,n=i.direction,a=i.itemSize,o=i.layout,c=s._getItemStyleCache(d&&a,d&&o,d&&n);if(c.hasOwnProperty(e))t=c[e];else{var h=r(s.props,e,s._instanceProps),x=l(s.props,e,s._instanceProps),m="horizontal"===n||"horizontal"===o,u="rtl"===n,f=m?h:0;c[e]=t={position:"absolute",left:u?void 0:f,right:u?f:void 0,top:m?0:h,height:m?"100%":x,width:m?x:"100%"}}return t},s._getItemStyleCache=void 0,s._getItemStyleCache=F((function(e,t,s){return{}})),s._onScrollHorizontal=function(e){var t=e.currentTarget,r=t.clientWidth,i=t.scrollLeft,l=t.scrollWidth;s.setState((function(e){if(e.scrollOffset===i)return null;var t=s.props.direction,n=i;if("rtl"===t)switch(B()){case"negative":n=-i;break;case"positive-descending":n=l-r-i}return n=Math.max(0,Math.min(n,l-r)),{isScrolling:!0,scrollDirection:e.scrollOffset<n?"forward":"backward",scrollOffset:n,scrollUpdateWasRequested:!1}}),s._resetIsScrollingDebounced)},s._onScrollVertical=function(e){var t=e.currentTarget,r=t.clientHeight,i=t.scrollHeight,l=t.scrollTop;s.setState((function(e){if(e.scrollOffset===l)return null;var t=Math.max(0,Math.min(l,i-r));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),s._resetIsScrollingDebounced)},s._outerRefSetter=function(e){var t=s.props.outerRef;s._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},s._resetIsScrollingDebounced=function(){var e,t,r,i;null!==s._resetIsScrollingTimeoutId&&E(s._resetIsScrollingTimeoutId),s._resetIsScrollingTimeoutId=(e=s._resetIsScrolling,t=150,r=L(),i={id:requestAnimationFrame((function s(){L()-r>=t?e.call(null):i.id=requestAnimationFrame(s)}))})},s._resetIsScrolling=function(){s._resetIsScrollingTimeoutId=null,s.setState({isScrolling:!1},(function(){s._getItemStyleCache(-1,null)}))},s}x=t,(s=m).prototype=Object.create(x.prototype),s.prototype.constructor=s,_(s,x),m.getDerivedStateFromProps=function(e,t){return $(e,t),h(e),null};var u=m.prototype;return u.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},u.scrollToItem=function(e,t){void 0===t&&(t="auto");var s=this.props,r=s.itemCount,i=s.layout,l=this.state.scrollOffset;e=Math.max(0,Math.min(e,r-1));var a=0;if(this._outerRef){var o=this._outerRef;a="vertical"===i?o.scrollWidth>o.clientWidth?q():0:o.scrollHeight>o.clientHeight?q():0}this.scrollTo(n(this.props,e,t,l,this._instanceProps,a))},u.componentDidMount=function(){var e=this.props,t=e.direction,s=e.initialScrollOffset,r=e.layout;if("number"==typeof s&&null!=this._outerRef){var i=this._outerRef;"horizontal"===t||"horizontal"===r?i.scrollLeft=s:i.scrollTop=s}this._callPropsCallbacks()},u.componentDidUpdate=function(){var e=this.props,t=e.direction,s=e.layout,r=this.state,i=r.scrollOffset;if(r.scrollUpdateWasRequested&&null!=this._outerRef){var l=this._outerRef;if("horizontal"===t||"horizontal"===s)if("rtl"===t)switch(B()){case"negative":l.scrollLeft=-i;break;case"positive-ascending":l.scrollLeft=i;break;default:var n=l.clientWidth,a=l.scrollWidth;l.scrollLeft=a-n-i}else l.scrollLeft=i;else l.scrollTop=i}this._callPropsCallbacks()},u.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&E(this._resetIsScrollingTimeoutId)},u.render=function(){var t=this.props,s=t.children,r=t.className,l=t.direction,n=t.height,a=t.innerRef,o=t.innerElementType,c=t.innerTagName,d=t.itemCount,h=t.itemData,x=t.itemKey,m=void 0===x?H:x,u=t.layout,f=t.outerElementType,p=t.outerTagName,g=t.style,y=t.useIsScrolling,b=t.width,v=this.state.isScrolling,j="horizontal"===l||"horizontal"===u,w=j?this._onScrollHorizontal:this._onScrollVertical,N=this._getRangeToRender(),S=N[0],k=N[1],I=[];if(d>0)for(var _=S;_<=k;_++)I.push(e.createElement(s,{data:h,key:m(_,h),index:_,isScrolling:y?v:void 0,style:this._getItemStyle(_)}));var P=i(this.props,this._instanceProps);return e.createElement(f||p||"div",{className:r,onScroll:w,ref:this._outerRefSetter,style:C({position:"relative",height:n,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:l},g)},e.createElement(o||c||"div",{children:I,ref:a,style:{height:j?"100%":P,pointerEvents:v?"none":void 0,width:j?P:"100%"}}))},u._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],s=e[1],r=e[2],i=e[3];this._callOnItemsRendered(t,s,r,i)}if("function"==typeof this.props.onScroll){var l=this.state,n=l.scrollDirection,a=l.scrollOffset,o=l.scrollUpdateWasRequested;this._callOnScroll(n,a,o)}},u._getRangeToRender=function(){var e=this.props,t=e.itemCount,s=e.overscanCount,r=this.state,i=r.isScrolling,l=r.scrollDirection,n=r.scrollOffset;if(0===t)return[0,0,0,0];var c=a(this.props,n,this._instanceProps),d=o(this.props,c,n,this._instanceProps),h=i&&"backward"!==l?1:Math.max(1,s),x=i&&"forward"!==l?1:Math.max(1,s);return[Math.max(0,c-h),Math.max(0,Math.min(t-1,d+x)),c,d]},m}(e.PureComponent)).defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},s}var $=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},K=U({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,s,r,i,l){var n=e.direction,a=e.height,o=e.itemCount,c=e.itemSize,d=e.layout,h=e.width,x="horizontal"===n||"horizontal"===d?h:a,m=Math.max(0,o*c-x),u=Math.min(m,t*c),f=Math.max(0,t*c-x+c+l);switch("smart"===s&&(s=r>=f-x&&r<=u+x?"auto":"center"),s){case"start":return u;case"end":return f;case"center":var p=Math.round(f+(u-f)/2);return p<Math.ceil(x/2)?0:p>m+Math.floor(x/2)?m:p;default:return r>=f&&r<=u?r:r<f?f:u}},getStartIndexForOffset:function(e,t){var s=e.itemCount,r=e.itemSize;return Math.max(0,Math.min(s-1,Math.floor(t/r)))},getStopIndexForStartIndex:function(e,t,s){var r=e.direction,i=e.height,l=e.itemCount,n=e.itemSize,a=e.layout,o=e.width,c=t*n,d="horizontal"===r||"horizontal"===a?o:i,h=Math.ceil((d+s-c)/n);return Math.max(0,Math.min(l-1,t+h-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}});const Y=()=>{const{user:r}=t(),[i,l]=e.useState(g),[a,o]=e.useState(!0),[c,d]=e.useState(null),[h,x]=e.useState(""),[S,k]=e.useState(null),[C,_]=e.useState(null),[P,z]=e.useState({}),[T,D]=e.useState(!1),[R,F]=e.useState(!1),[L,E]=e.useState(!1),[W,q]=e.useState((null==r?void 0:r.email)||""),A=y(),B=((t,s)=>{const[r,i]=e.useState(t);return e.useEffect((()=>{const e=setTimeout((()=>{i(t)}),s);return()=>{clearTimeout(e)}}),[t,s]),r})(h,300);e.useEffect((()=>{r&&q(r.email||"")}),[r]),e.useEffect((()=>{var e;(null==(e=A.state)?void 0:e.selectedStock)&&(k(A.state.selectedStock),_(A.state.selectedStock))}),[A.state]),e.useEffect((()=>{try{I.init("eyK87ZsxW822cQvyN")}catch(e){console.error("Failed to initialize EmailJS:",e)}}),[]),e.useEffect((()=>{o(!0);const e=setTimeout((()=>{l(g),o(!1)}),4e3);return()=>clearTimeout(e)}),[]),e.useEffect((()=>{const e=setInterval((()=>{l((e=>e.map((e=>{const t=2*(Math.random()-.5),s=(e.price||100)+t;return z((s=>({...s,[e.symbol]:t}))),{...e,price:s,change:t,changePercent:t/(e.price||100)*100}}))))}),5e3);return()=>clearInterval(e)}),[]);const H=e.useMemo((()=>i.filter((e=>e.symbol.toLowerCase().includes(B.toLowerCase())||e.name.toLowerCase().includes(B.toLowerCase())))),[B,i]);return s.jsxs("div",{className:"min-h-screen w-full  text-black",children:[s.jsx(b,{}),s.jsx("div",{children:s.jsx("div",{className:"mt-28 absolute flex z-20 px-8 justify-end w-full",children:C&&s.jsxs("button",{onClick:()=>E(!0),className:"px-8 py-3 bg-black text-white font-medium rounded-full hover:bg-black/90 transition-all flex items-center gap-2",children:[s.jsx(v,{size:16}),"Buy ",C.symbol]})})}),s.jsxs("div",{className:"flex h-screen pt-20",children:[s.jsx("div",{className:"w-98 bg-white border-r  border-gray-200 overflow-hidden",children:s.jsxs("div",{className:"p-6 ",children:[s.jsxs("div",{className:"relative mb-6",children:[s.jsx(j,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),s.jsx("input",{type:"text",placeholder:"Search stocks...",value:h,onChange:e=>x(e.target.value),className:"w-full bg-gray-50 border border-gray-200 rounded-2xl pl-10 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300"})]}),s.jsx("div",{className:"space-y-4 overflow-y-auto w-[400px] hide-scrollbar",children:a?s.jsx(w,{}):s.jsx(K,{height:600,itemCount:H.length,itemSize:80,width:400,children:({index:t,style:r})=>{const i=H[t],l=(null==C?void 0:C.symbol)===i.symbol,[a,o]=e.useState(null),[c,h]=e.useState(!0);return e.useEffect((()=>{if(t>=15)return o({...i,price:i.price||0,change:0,changePercent:0,highPrice:0,lowPrice:0,openPrice:0,previousClose:0}),void h(!1);(async()=>{try{const e=await fetch(`https://finnhub.io/api/v1/quote?symbol=${i.symbol}&token=ctre6q9r01qhb16mmh70ctre6q9r01qhb16mmh7g`);if(!e.ok)throw new Error("Failed to fetch stock data");const t=await e.json();o({...i,price:t.c||0,change:t.d||0,changePercent:t.dp||0,highPrice:t.h||0,lowPrice:t.l||0,openPrice:t.o||0,previousClose:t.pc||0})}catch(e){console.error(`Failed to fetch data for ${i.symbol}:`,e),o({...i,price:i.price||0,change:0,changePercent:0,highPrice:0,lowPrice:0,openPrice:0,previousClose:0})}finally{h(!1)}})()}),[i.symbol,t]),c||!a?s.jsx(n.div,{style:{...r,marginBottom:"16px"},className:"p-4 w-98 bg-white hover:bg-gray-50 transition-colors duration-200 cursor-pointer",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-sm text-black",children:i.symbol}),s.jsx("p",{className:"text-xs text-gray-600",children:i.name})]}),s.jsx("div",{className:"text-right",children:s.jsx("p",{className:"font-medium text-sm text-black",children:"Loading..."})})]})}):s.jsx(n.div,{style:{...r,marginBottom:"16px"},layout:!0,className:`p-4 w-98 ${l?"bg-gray-200 rounded":"bg-white hover:bg-gray-50"} transition-colors duration-200 cursor-pointer`,onClick:()=>(async e=>{D(!0),_(e);try{const t={...e};_(t)}catch(t){console.error("Failed to load stock details:",t),d("Failed to load stock details")}finally{D(!1)}})(a),children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-sm text-black",children:a.symbol}),s.jsx("p",{className:"text-xs text-gray-600",children:a.name})]}),s.jsxs(n.div,{animate:{color:(a.changePercent||0)>=0?"#16a34a":"#dc2626"},className:"text-right",children:[s.jsxs("p",{className:"font-medium text-sm text-black",children:["₹",(a.price||0).toFixed(2)]}),s.jsx("p",{className:"text-xs flex items-center gap-1",children:void 0!==a.changePercent&&s.jsxs(s.Fragment,{children:[a.changePercent>=0?s.jsx(f,{size:10}):s.jsx(p,{size:10}),Math.abs(a.changePercent).toFixed(2),"%"]})})]})]})})}})})]})}),s.jsx("div",{className:"flex-1",children:T?s.jsx(w,{}):C?s.jsx(M,{stock:C,onBuyClick:k,loading:a}):s.jsx("div",{className:"h-full flex items-center justify-center text-gray-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx(m,{size:32,className:"mx-auto mb-4 opacity-60"}),s.jsx("p",{className:"text-lg",children:"Select a stock to view details"})]})})})]}),s.jsx(u,{children:R&&s.jsxs(n.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"fixed inset-0 flex items-center justify-center z-50",children:[s.jsx("div",{className:"bg-black/50 backdrop-blur-sm fixed inset-0"}),s.jsx(n.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"bg-white/90 backdrop-blur-lg rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 border border-gray-200",children:s.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[s.jsx("div",{className:"bg-green-500/10 rounded-full p-3",children:s.jsx(N,{className:"w-6 h-6 text-green-500"})}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Success!"}),s.jsx("p",{className:"text-gray-600",children:"Transaction completed successfully! A notification has been sent to your email."}),s.jsx("button",{onClick:()=>F(!1),className:"mt-4 px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Close"})]})})]})}),s.jsx(u,{children:L&&C&&s.jsx(O,{stock:C,onClose:()=>E(!1),onSuccess:(e,t)=>(async(e,t,s)=>{if("number"!=typeof s||isNaN(s))console.error("Invalid totalPrice:",s);else if(F(!0),setTimeout((()=>{F(!1)}),3e3),null==r?void 0:r.email)try{const i={to_email:r.email,stock_symbol:e.symbol,stock_name:e.name,quantity:t,total_price:s.toFixed(2)};await I.send("service_box535f","template_l4fugpk",i),console.log("Email notification sent successfully!")}catch(i){console.error("Failed to send email notification:",i)}else console.error("User email not found."),alert("User email not found. Please update your email in settings.")})(C,e,t)})})]})};export{Y as BuyStocks,Y as default};
//# sourceMappingURL=BuyStocks-DYjvdait.js.map
